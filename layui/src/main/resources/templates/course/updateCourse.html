<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>layui</title>
    <meta content="webkit" name="renderer">
    <meta content="IE=edge,chrome=1" http-equiv="X-UA-Compatible">
    <meta content="width=device-width, initial-scale=1, maximum-scale=1" name="viewport">
    <link href="/layui-style/lib/layui-v2.6.3/css/layui.css" media="all" rel="stylesheet">
    <link href="/layui-style/css/public.css" media="all" rel="stylesheet">
    <style>
        body {
            background-color: #ffffff;
        }
    </style>
</head>
<body>
<div class="layui-form layuimini-form">
    <div class="layui-form-item">
        <input hidden name="course_id" th:value="${course.course_id}" type="text">
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">选择分类</label>
        <div class="layui-input-inline">
            <select id="subject_id" class="layui-select" lay-verify="subject_id" name="subject_id">
                <option value="">请选择专题</option>
                <option th:each="subject:${subjectList}" th:selected="${course.subject_id} eq ${subject.subject_id}"
                        th:text="${subject.subject_title}" th:value="${subject.subject_id}"></option>
            </select>
            <!-- <input type="text" name="subject_id" autocomplete="off" id="subject_id" class="layui-input">-->
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label required">课程名称</label>
        <div class="layui-input-block">
            <input class="layui-input" lay-reqtext="课程名称不能为空" lay-verify="required" name="course_title"
                   placeholder="请输入课程名称" th:value="${course.course_title}" type="text">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">课程副标题</label>
        <div class="layui-input-block">
            <input class="layui-input" name="course_subtitle" placeholder="请输入课程副标题"
                   th:value="${course.course_subtitle}" type="text">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label " required>课程简介</label>
        <textarea id="course_desc" class="layui-textarea " lay-reqtext="课程简介不能为空"
                  lay-verify="course_desc" name="course_desc" placeholder="请输内容"
                  th:text="${course.course_desc}"></textarea>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">课程难度</label>
        <div class="layui-input-block">
            <select id="course_level" class="layui-select" name="course_level">
                <option th:selected="${course.course_level} eq '一般'" value="一般">一般</option>
                <option th:selected="${course.course_level} eq '简单'" value="简单">简单</option>
                <option th:selected="${course.course_level} eq '难'" value="难">难</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">打折描述</label>
        <div class="layui-input-block">
            <textarea class="layui-input" name="discount_desc" th:text="${course.discount_desc}" type="text"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">商品价格</label>
        <div class="layui-input-block">
            <input checked lay-filter="is_discount" name="is_discount"
                   th:attr="checked=${course.is_discount=='0'?true:false}" title="原价" type="radio" value="0">
            <input lay-filter="is_discount" name="is_discount" th:attr="checked=${course.is_discount=='1'?true:false}"
                   title="折扣" type="radio" value="1">
            原价：<input id="course_price" lay-filter="course_price" lay-verify="course_price" min="0" name="course_price"
                      required style="width: 50px" th:value="${course.course_price}" type="number">
            折后价：<input id="discount_price" lay-verify="discount_price" min="0" name="discount_price" style="width: 50px"
                       th:attr="disabled=${course.is_discount== '1' ? false : true}" th:value="${course.discount_price}"
                       type="number">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否轮播</label>
        <div class="layui-input-block">
            <input checked="" name="is_carousel" th:attr="checked=${course.is_carousel=='1'?true:false}" title="是"
                   type="radio" value="1">
            <input name="is_carousel" th:attr="checked=${course.is_carousel=='0'?true:false}" title="否" type="radio"
                   value="0">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否精品推荐</label>
        <div class="layui-input-block">
            <input checked="" name="is_recommend" th:attr="checked=${course.is_recommend=='1'?true:false}" title="是"
                   type="radio" value="1">
            <input name="is_recommend" th:attr="checked=${course.is_recommend=='0'?true:false}" title="否" type="radio"
                   value="0">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否免费</label>
        <div class="layui-input-block">
            <input checked="" name="is_free" th:attr="checked=${course.is_free=='1'?true:false}" title="是" type="radio"
                   value="1">
            <input name="is_free" th:attr="checked=${course.is_free=='0'?true:false}" title="否" type="radio" value="0">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否对外</label>
        <div class="layui-input-block">
            <input checked="" name="course_if_foreign" th:attr="checked=${course.course_if_foreign=='1'?true:false}"
                   title="是" type="radio" value="1">
            <input name="course_if_foreign" th:attr="checked=${course.course_if_foreign=='0'?true:false}" title="否"
                   type="radio" value="0">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">封面上传</label>
        <input id="course_cover" name="course_cover" th:value="${course.course_cover}" type="hidden">
        <div class="layui-upload">
            <button id="course_cover_upload" class="layui-btn layui-btn-normal" type="button">选择文件</button>
            <div class="layui-upload-list" style="margin-left: 150px">
                <img id="course_cover_demo" class="layui-upload-img" height="100px" th:src="${course.course_cover}"
                     width="100px">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">轮播图上传</label>
        <input id="course_banner" name="course_banner" th:value="${course.course_banner}" type="hidden">
        <div class="layui-upload">
            <button id="course_banner_upload" class="layui-btn layui-btn-normal" type="button">选择文件</button>
            <div class="layui-upload-list" style="margin-left: 150px">
                <img id="course_banner_demo" class="layui-upload-img" height="100px" th:src="${course.course_banner}"
                     width="100px">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">详情图片上传</label>
        <input id="detail_img" name="detail_img" th:value="${course.detail_img}" type="hidden">
        <div class="layui-upload">
            <button id="detail_img_upload" class="layui-btn layui-btn-normal" type="button">选择文件</button>
            <div class="layui-upload-list" style="margin-left: 150px">
                <img id="detail_img_demo" class="layui-upload-img" height="100px" th:src="${course.detail_img}"
                     width="100px">
            </div>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label">是否展示详情</label>
        <div class="layui-input-block">
            <input checked="" name="show_detail_img" th:attr="checked=${course.show_detail_img=='1'?true:false}"
                   title="是" type="radio" value="1">
            <input name="show_detail_img" th:attr="checked=${course.show_detail_img=='0'?true:false}" title="否"
                   type="radio" value="0">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">课程详情介绍</label>
        <div class="layui-input-block">
            <textarea class="layui-input" name="course_detail" th:text="${course.course_detail}" type="text"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">播放量</label>
        <div class="layui-input-block">
            <input class="layui-input" name="view_counts" th:value="${course.view_counts}" type="number">
        </div>
    </div>
    <div class="layui-form-item">
        <label class="layui-form-label ">上线状态</label>
        <div class="layui-input-block">
            <select id="enable" class="layui-select" name="enable">
                <option th:selected="${course.enable} eq '1'" value="1">上线</option>
                <option th:selected="${course.enable} eq '0'" value="0">下线</option>
            </select>
        </div>
    </div>
    <div class="layui-form-item layui-form-text">
        <label class="layui-form-label">备注信息</label>
        <div class="layui-input-block">
            <textarea class="layui-textarea" name="remark" placeholder="请输入备注信息" th:text="${course.remark}"></textarea>
        </div>
    </div>
    <div class="layui-form-item">
        <div class="layui-input-block">
            <button class="layui-btn layui-btn-normal" lay-filter="saveBtn" lay-submit>确认保存</button>
        </div>
    </div>
</div>
<script charset="utf-8" src="/layui-style/lib/layui-v2.6.3/layui.js"></script>
<script>
    layui.use('upload', function () {
        var $ = layui.jquery
            , upload = layui.upload;
        //封面
        upload.render({
            elem: '#course_cover_upload',
            url: '/course/uploadFile',
            before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#course_cover_demo').attr('src', result);
                });
            },
            field: 'course_cover_img'
            , accept: 'file'
            , auto: true //是否自动上传
            , done: function (res) {
                if (res.code > 0) {
                    return layer.msg('上传失败');
                } else {
                    //上传成功
                    layer.msg("上传成功")
                    $('#course_cover').val(res.data.src)
                    console.log($('#course_cover').val())
                }
            }
            , error: function () {
                layer.msg("服务器异常")
            }
        });
        //轮播图
        upload.render({
            elem: '#course_banner_upload',
            url: '/course/uploadFile',
            before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#course_banner_demo').attr('src', result); //图片链接（base64）
                });
            },
            field: 'course_banner_img'
            , accept: 'file'
            , auto: true //是否自动上传
            , done: function (res) {
                if (res.code > 0) {
                    return layer.msg('上传失败');
                } else {
                    //上传成功
                    layer.msg("上传成功")
                    $('#course_banner').val(res.data.src)
                }
            }
            , error: function () {
                layer.msg("服务器异常")
            }
        });
        //详情
        upload.render({
            elem: '#detail_img_upload',
            url: '/course/uploadFile',
            before: function (obj) {
                //预读本地文件示例，不支持ie8
                obj.preview(function (index, file, result) {
                    $('#detail_img_demo').attr('src', result); //图片链接（base64）
                });
            },
            field: 'detail_img_img'
            , accept: 'file'
            , auto: true //是否自动上传
            , done: function (res) {
                if (res.code > 0) {
                    return layer.msg('上传失败');
                } else {
                    //上传成功
                    layer.msg("上传成功")
                    $('#detail_img').val(res.data.src)
                }
            }
            , error: function () {
                layer.msg("服务器异常")
            }
        })
    });
    layui.use(['layedit', 'form'], function () {
        var layedit = layui.layedit;
        var form = layui.form;
        var index = layedit.build('course_desc', {
            tool: ['strong', 'italic', 'underline', 'del', '|', 'left', 'center', 'right', 'link', 'unlink']
        }); //建立编辑器
        //自定义验证规则
        form.verify({
            course_desc: function (value) {
                layedit.sync(index);
            }
        });

    });
    layui.use(['form'], function () {
        var form = layui.form,
            layer = layui.layer,
            $ = layui.$;
        //自定义验证规则
        form.verify({
            subject_id: function (value) {
                if (value <= 0 || value == "" || value == null) {
                    return '请选择分类';
                }
            },
            course_price: function (value) {
                if (value <= 0 || value == "" || value == null) {
                    return '请输入原价';
                }
            }
        });
        //监听提交
        form.on('submit(saveBtn)', function (data) {
            var index = layer.alert(JSON.stringify(data.field), {
                title: '最终的提交信息'
            }, function () {
                $.ajax({
                    url: '/course/updateCourse',
                    type: 'POST',
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify(data.field),
                    success: function (result) {
                        if (result.code == 0) {
                            setTimeout(function () {
                                // 关闭弹出层
                                layer.close(index);
                                window.parent.location.href = "/course/toCourse";
                                var iframeIndex = parent.layer.getFrameIndex(window.name);
                                parent.layer.close(iframeIndex);
                            }, 300);
                        } else {
                            layer.msg("操作失败！", {icon: 5});
                        }
                    }
                });
            });
            return false;
        });
        form.on("radio(is_discount)", function (data) {
            var is_discount = data.value;
            if (is_discount === '1') {

                $('#discount_price').attr("disabled", false);
                $('#discount_price').val('')
                form.verify({
                    discount_price: function (value) {
                        if (value <= 0 || value == "" || value == null) {
                            return '请输入原价';
                        }
                    }
                });
            } else if (is_discount === '0') {
                $('#discount_price').val('')
                $('#discount_price').attr("disabled", true);
            }
        });
        //监听input文本可输入字数
        $("#course_price").on("input", function (e) {
            $('#discount_price').val('')
            //获取input输入的值
            var course_price = $('#course_price').val();
            $('#discount_price').attr("oninput", "if(value>" + course_price + ")value=" + course_price);
        });
    });
</script>
</body>
</html>